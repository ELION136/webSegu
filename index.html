<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zona Segura 360¬∞ - Edici√≥n Mejorada</title>
    <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --card-hover: #334155;
            --text: #f1f5f9;
            --text-dim: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Fondo animado */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .stars {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Header mejorado */
        header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 16px;
            border-radius: 20px;
            transition: transform 0.3s;
        }

        .stat-item:hover {
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Selector de escenarios */
        .scenario-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .scenario-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.3);
        }

        .scenario-card.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border-color: #667eea;
        }

        .scenario-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .scenario-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .scenario-desc {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        /* Layout principal mejorado */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 20px;
            margin: 20px 0;
        }

        /* Escenario 3D mejorado */
        .scene-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .scene-title {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .time-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .scene-3d {
            position: relative;
            width: 100%;
            height: 500px;
            background: linear-gradient(to bottom, #87ceeb, #e0f2fe);
            border-radius: 12px;
            overflow: hidden;
            perspective: 1000px;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.2);
        }

        /* Efectos de tiempo */
        .scene-3d.night {
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
        }

        .scene-3d.evening {
            background: linear-gradient(to bottom, #ff6b6b, #feca57);
        }

        /* Sol/Luna */
        .celestial-body {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            transition: all 1s ease;
            filter: drop-shadow(0 0 20px currentColor);
        }

        .sun {
            background: radial-gradient(circle, #ffd700, #ff8c00);
            top: 30px;
            right: 50px;
        }

        .moon {
            background: radial-gradient(circle, #f0f0f0, #c0c0c0);
            top: 30px;
            right: 50px;
            display: none;
        }

        .scene-3d.night .moon {
            display: block;
        }

        .scene-3d.night .sun {
            display: none;
        }

        /* Elementos de escena mejorados */
        .lighting-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            transition: all 0.5s;
            pointer-events: none;
            mix-blend-mode: multiply;
        }

        .room-3d {
            position: absolute;
            inset: 0;
            transform-style: preserve-3d;
        }

        .wall {
            position: absolute;
            background: linear-gradient(to bottom, #e8e8e8, #d0d0d0);
            border: 1px solid #999;
        }

        .wall.back {
            top: 50px;
            left: 10%;
            right: 10%;
            height: 300px;
            transform: translateZ(-100px);
        }

        .wall.left {
            top: 50px;
            left: 10%;
            width: 150px;
            height: 300px;
            background: linear-gradient(to right, #c0c0c0, #d0d0d0);
            transform: rotateY(90deg) translateZ(-75px);
        }

        .floor {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: repeating-linear-pattern;
            background: 
                repeating-linear-gradient(
                    90deg,
                    #8b7355 0px,
                    #8b7355 50px,
                    #7a6446 50px,
                    #7a6446 100px
                );
            border-top: 3px solid #654321;
        }

        .furniture {
            position: absolute;
            transition: all 0.5s;
        }

        .desk {
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 100px;
            background: linear-gradient(to bottom, #8b4513, #654321);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .desk::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 0;
            right: 0;
            height: 8px;
            background: #654321;
            border-radius: 8px 8px 0 0;
        }

        .monitor {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 70px;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 3px solid #000;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .monitor::after {
            content: '';
            position: absolute;
            inset: 5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0.8;
        }

        .chair {
            bottom: 180px;
            left: 40%;
            width: 60px;
            height: 80px;
            background: linear-gradient(to bottom, #333, #555);
            border-radius: 8px 8px 0 0;
        }

        .plant {
            bottom: 150px;
            right: 15%;
            width: 50px;
            height: 80px;
        }

        .plant-pot {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 30px;
            background: linear-gradient(to bottom, #8b4513, #654321);
            border-radius: 0 0 8px 8px;
        }

        .plant-leaves {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .window-frame {
            position: absolute;
            top: 80px;
            right: 12%;
            width: 150px;
            height: 180px;
            background: rgba(135, 206, 250, 0.3);
            border: 5px solid #666;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 5px;
            padding: 5px;
            transition: all 0.5s;
            box-shadow: inset 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .window-frame.closed {
            background: rgba(100, 100, 100, 0.6);
        }

        .window-pane {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }

        .worker-avatar {
            position: absolute;
            bottom: 250px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 5rem;
            transition: all 0.5s;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.4));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* Part√≠culas mejoradas */
        .particles-container {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .air-particle {
            position: absolute;
            width: 4px;
            height: 25px;
            background: linear-gradient(to bottom, rgba(173, 216, 230, 0), rgba(173, 216, 230, 0.8), rgba(173, 216, 230, 0));
            border-radius: 2px;
            animation: airFlow 4s linear infinite;
            filter: blur(1px);
        }

        @keyframes airFlow {
            from {
                transform: translate(0, 0) rotate(0deg);
                opacity: 0;
            }
            20% { opacity: 1; }
            80% { opacity: 1; }
            to {
                transform: translate(150px, -100px) rotate(180deg);
                opacity: 0;
            }
        }

        .dust-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: dustFloat 6s ease-in-out infinite;
        }

        @keyframes dustFloat {
            0%, 100% {
                transform: translate(0, 0);
                opacity: 0.3;
            }
            50% {
                transform: translate(30px, -50px);
                opacity: 1;
            }
        }

        /* Panel de controles mejorado */
        .controls-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            max-height: 90vh;
            overflow-y: auto;
        }

        .controls-panel::-webkit-scrollbar {
            width: 8px;
        }

        .controls-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .controls-panel::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .control-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .control-group:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .value-badge {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Slider mejorado */
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
            position: relative;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            box-shadow: 0 0 10px var(--accent);
            transition: all 0.3s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 0 20px var(--accent);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px var(--accent);
        }

        /* Select mejorado */
        select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:hover {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.08);
        }

        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        select option {
            background: var(--card-bg);
            color: var(--text);
        }

        /* Toggle mejorado */
        .toggle-container {
            display: flex;
            gap: 15px;
        }

        .toggle-item {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .toggle-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.4s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            left: 4px;
            bottom: 4px;
            background: white;
            border-radius: 50%;
            transition: all 0.4s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        input:checked + .toggle-slider {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        input:checked + .toggle-slider::before {
            transform: translateX(24px);
        }

        /* Botones mejorados */
        .btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-icon {
            margin-right: 8px;
        }

        /* Dashboard mejorado */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .metric-card:hover::before {
            transform: scaleX(1);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 0.9rem;
            color: var(--text-dim);
            font-weight: 500;
        }

        .metric-icon {
            font-size: 1.8rem;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 6px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-optimal {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-acceptable {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .status-poor {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        /* Modal mejorado */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border: 2px solid var(--border);
            padding: 40px;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 1.8rem;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-btn {
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-dim);
            background: none;
            border: none;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .info-section {
            margin: 25px 0;
        }

        .info-section h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .info-box {
            background: rgba(6, 182, 212, 0.1);
            border-left: 4px solid var(--accent);
            padding: 18px;
            margin: 12px 0;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .info-box:hover {
            background: rgba(6, 182, 212, 0.15);
            transform: translateX(5px);
        }

        .info-box strong {
            color: var(--accent);
            font-weight: 600;
        }

        /* Efectos especiales */
        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--success);
            animation: confettiFall 3s ease-out forwards;
            z-index: 9999;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            padding: 18px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
            z-index: 1000;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .achievements-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 999;
        }

        .achievement-item {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.5s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .achievement-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .achievement-text {
            flex: 1;
        }

        .achievement-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .achievement-desc {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        /* Sonido toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
            z-index: 999;
        }

        .sound-toggle:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .achievements-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .stats-bar {
                gap: 10px;
            }

            .stat-item {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .scene-3d {
                height: 350px;
            }

            .worker-avatar {
                font-size: 3.5rem;
                bottom: 200px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 25px;
            }

            .toast {
                right: 10px;
                left: 10px;
                bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="stars" id="stars"></div>

    <!-- Sound Toggle -->
    <div class="sound-toggle" id="soundToggle" title="Toggle Sound">
        üîä
    </div>

    <!-- Achievements Panel -->
    <div class="achievements-panel" id="achievementsPanel"></div>

    <header>
        <h1>üè¢ Zona Segura 360¬∞ - Edici√≥n Mejorada</h1>
        <p class="subtitle" style="color: var(--text-dim); margin-bottom: 15px;">
            Simulador Avanzado de Condiciones Laborales √ìptimas
        </p>
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-icon">üèÜ</span>
                <span><strong id="totalScore">0</strong> pts</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">‚≠ê</span>
                <span><strong id="achievementCount">0</strong>/10 logros</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">‚è±Ô∏è</span>
                <span><strong id="timeDisplay">D√≠a</strong></span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">üéØ</span>
                <span>Racha: <strong id="streakCount">0</strong></span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Selector de Escenarios -->
        <div class="scenario-selector">
            <div class="scenario-card active" data-scenario="office">
                <div class="scenario-icon">üè¢</div>
                <div class="scenario-name">Oficina</div>
                <div class="scenario-desc">300-500 lux, 20-24¬∞C</div>
            </div>
            <div class="scenario-card" data-scenario="lab">
                <div class="scenario-icon">üî¨</div>
                <div class="scenario-name">Laboratorio</div>
                <div class="scenario-desc">500-1000 lux, 18-22¬∞C</div>
            </div>
            <div class="scenario-card" data-scenario="warehouse">
                <div class="scenario-icon">üì¶</div>
                <div class="scenario-name">Almac√©n</div>
                <div class="scenario-desc">200-400 lux, 16-26¬∞C</div>
            </div>
            <div class="scenario-card" data-scenario="creative">
                <div class="scenario-icon">üé®</div>
                <div class="scenario-name">Estudio Creativo</div>
                <div class="scenario-desc">400-600 lux, 20-23¬∞C</div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">üí° Iluminaci√≥n</span>
                    <span class="metric-icon">üí°</span>
                </div>
                <div class="metric-value" id="luxMetricValue">0 lux</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="luxProgress"></div>
                </div>
                <span class="status-badge status-poor" id="luxStatusBadge">‚ö†Ô∏è Insuficiente</span>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">üå¨Ô∏è Ventilaci√≥n</span>
                    <span class="metric-icon">üå¨Ô∏è</span>
                </div>
                <div class="metric-value" id="airMetricValue">Sin flujo</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="airProgress"></div>
                </div>
                <span class="status-badge status-poor" id="airStatusBadge">‚ö†Ô∏è Malo</span>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">üë§ Trabajador</span>
                    <span class="metric-icon" id="workerMetricIcon">üòê</span>
                </div>
                <div class="metric-value" id="workerMetricStatus">Regular</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="workerProgress"></div>
                </div>
                <span id="workerConditionDesc" style="color: var(--text-dim); font-size: 0.9rem;">Condiciones normales</span>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">‚≠ê Confort Global</span>
                    <span class="metric-icon">üéØ</span>
                </div>
                <div class="metric-value" id="scoreMetricValue">0/100</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="scoreProgress"></div>
                </div>
                <span class="status-badge status-poor" id="scoreStatusBadge">üìâ Necesita mejoras</span>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="main-content">
            <!-- Escenario 3D -->
            <div class="scene-container">
                <div class="scene-header">
                    <div class="scene-title">
                        <span id="scenarioIcon">üè¢</span>
                        <span id="scenarioName">Oficina Moderna</span>
                    </div>
                    <div class="time-control">
                        <button class="time-btn active" data-time="day">‚òÄÔ∏è D√≠a</button>
                        <button class="time-btn" data-time="evening">üåÖ Tarde</button>
                        <button class="time-btn" data-time="night">üåô Noche</button>
                    </div>
                </div>

                <div class="scene-3d" id="scene3d">
                    <div class="celestial-body sun"></div>
                    <div class="celestial-body moon"></div>
                    <div class="lighting-overlay" id="lightingOverlay"></div>
                    
                    <div class="room-3d">
                        <div class="wall back"></div>
                        <div class="wall left"></div>
                        <div class="floor"></div>
                        
                        <div class="furniture window-frame" id="windowFrame">
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                        </div>

                        <div class="furniture desk">
                            <div class="monitor"></div>
                        </div>
                        
                        <div class="furniture chair"></div>
                        
                        <div class="furniture plant">
                            <div class="plant-pot"></div>
                            <div class="plant-leaves">üåø</div>
                        </div>

                        <div class="worker-avatar" id="workerAvatar">üòê</div>
                    </div>

                    <div class="particles-container" id="particlesContainer"></div>
                </div>
            </div>

            <!-- Panel de Controles -->
            <div class="controls-panel">
                <div class="control-section">
                    <div class="section-title">üí° Control de Iluminaci√≥n</div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Intensidad Lum√≠nica</span>
                            <span class="value-badge" id="luxValueDisplay">0 lux</span>
                        </div>
                        <input type="range" id="luxSlider" min="0" max="1200" value="200" step="10">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-dim); margin-top: 5px;">
                            <span>0</span>
                            <span>600</span>
                            <span>1200</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Tipo de L√°mpara</span>
                        </div>
                        <select id="lampType">
                            <option value="led">üí° LED - Eficiente y Fr√≠a</option>
                            <option value="fluorescent">üîÜ Fluorescente - Est√°ndar</option>
                            <option value="incandescent">üïØÔ∏è Incandescente - C√°lida</option>
                            <option value="halogen">‚ú® Hal√≥gena - Brillante</option>
                        </select>
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">üå¨Ô∏è Sistema de Ventilaci√≥n</div>
                    
                    <div class="toggle-container">
                        <div class="toggle-item">
                            <span>ü™ü Ventanas</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="windowToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-item">
                            <span>üí® Extractor</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="extractorToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>üåÄ Velocidad de Extractor</span>
                            <span class="value-badge" id="fanSpeedDisplay">0%</span>
                        </div>
                        <input type="range" id="fanSpeedSlider" min="0" max="100" value="0" step="10">
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">üå°Ô∏è Control de Temperatura</div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Temperatura Ambiente</span>
                            <span class="value-badge" id="tempValueDisplay">22¬∞C</span>
                        </div>
                        <input type="range" id="tempSlider" min="15" max="35" value="22" step="0.5">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-dim); margin-top: 5px;">
                            <span>15¬∞C</span>
                            <span>25¬∞C</span>
                            <span>35¬∞C</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>üíß Humedad Relativa</span>
                            <span class="value-badge" id="humidityDisplay">50%</span>
                        </div>
                        <input type="range" id="humiditySlider" min="30" max="70" value="50" step="5">
                    </div>
                </div>

                <button class="btn" onclick="autoOptimize()">
                    <span class="btn-icon">‚ú®</span> Auto-Optimizar Ambiente
                </button>
                <button class="btn btn-secondary" onclick="showSummary()">
                    <span class="btn-icon">üìö</span> Gu√≠a Educativa Completa
                </button>
                <button class="btn btn-danger" onclick="resetAll()">
                    <span class="btn-icon">üîÑ</span> Reiniciar Todo
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Resumen -->
    <div class="modal" id="summaryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìö Gu√≠a Educativa Completa</h2>
                <button class="close-btn" onclick="closeSummary()">&times;</button>
            </div>

            <div class="info-section">
                <h3>üí° Niveles de Iluminaci√≥n Recomendados</h3>
                <div class="info-box">
                    <strong>üè¢ Oficinas generales:</strong> 300-500 lux para trabajo en computadora y lectura
                </div>
                <div class="info-box">
                    <strong>üî¨ Laboratorios:</strong> 500-1000 lux para trabajo de precisi√≥n
                </div>
                <div class="info-box">
                    <strong>üì¶ Almacenes:</strong> 200-400 lux para circulaci√≥n y manejo de mercanc√≠as
                </div>
                <div class="info-box">
                    <strong>üé® Estudios creativos:</strong> 400-600 lux para dise√±o y arte
                </div>
            </div>

            <div class="info-section">
                <h3>üå¨Ô∏è Sistemas de Ventilaci√≥n</h3>
                <div class="info-box">
                    <strong>Ventilaci√≥n Natural:</strong> Apertura de ventanas para renovaci√≥n de aire. Efectiva con viento cruzado.
                </div>
                <div class="info-box">
                    <strong>Ventilaci√≥n Mec√°nica:</strong> Extractores y ventiladores. Control preciso del flujo de aire.
                </div>
                <div class="info-box">
                    <strong>Sistema Mixto:</strong> Combinaci√≥n de natural y mec√°nica. M√°xima eficiencia energ√©tica.
                </div>
            </div>

            <div class="info-section">
                <h3>üå°Ô∏è Confort T√©rmico</h3>
                <div class="info-box">
                    <strong>Temperatura ideal:</strong> 20-24¬∞C para oficinas. 18-22¬∞C para trabajo f√≠sico.
                </div>
                <div class="info-box">
                    <strong>Humedad relativa:</strong> 40-60% para m√°ximo confort y salud respiratoria.
                </div>
            </div>

            <div class="info-section">
                <h3>‚úÖ Tips Profesionales</h3>
                <div class="info-box">
                    <strong>1. Prevenci√≥n visual:</strong> Iluminaci√≥n adecuada reduce fatiga ocular en un 40%. Combina luz natural y artificial.
                </div>
                <div class="info-box">
                    <strong>2. Calidad del aire:</strong> Renovar el aire cada hora reduce CO‚ÇÇ y mejora concentraci√≥n en un 15%.
                </div>
                <div class="info-box">
                    <strong>3. Productividad:</strong> Ambientes √≥ptimos aumentan rendimiento hasta un 20% y reducen ausentismo.
                </div>
                <div class="info-box">
                    <strong>4. Eficiencia energ√©tica:</strong> L√°mparas LED consumen 80% menos que incandescentes.
                </div>
                <div class="info-box">
                    <strong>5. Ergonom√≠a lum√≠nica:</strong> Evita reflejos en pantallas. La luz debe venir desde arriba o laterales.
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN Y CONSTANTES
        // ==========================================
        
        const SCENARIOS = {
            office: {
                name: 'Oficina Moderna',
                icon: 'üè¢',
                luxMin: 300,
                luxMax: 500,
                luxIdeal: 400,
                tempMin: 20,
                tempMax: 24,
                tempIdeal: 22,
                humidityIdeal: 50
            },
            lab: {
                name: 'Laboratorio',
                icon: 'üî¨',
                luxMin: 500,
                luxMax: 1000,
                luxIdeal: 750,
                tempMin: 18,
                tempMax: 22,
                tempIdeal: 20,
                humidityIdeal: 45
            },
            warehouse: {
                name: 'Almac√©n',
                icon: 'üì¶',
                luxMin: 200,
                luxMax: 400,
                luxIdeal: 300,
                tempMin: 16,
                tempMax: 26,
                tempIdeal: 21,
                humidityIdeal: 55
            },
            creative: {
                name: 'Estudio Creativo',
                icon: 'üé®',
                luxMin: 400,
                luxMax: 600,
                luxIdeal: 500,
                tempMin: 20,
                tempMax: 23,
                tempIdeal: 21.5,
                humidityIdeal: 50
            }
        };

        // Estado global
        let state = {
            scenario: 'office',
            lux: 200,
            lampType: 'led',
            windowOpen: false,
            extractorOn: false,
            fanSpeed: 0,
            temperature: 22,
            humidity: 50,
            timeOfDay: 'day',
            score: 0,
            totalPoints: 0,
            streak: 0,
            soundEnabled: true
        };

        let achievements = {
            firstOptimal: false,
            perfectScore: false,
            allScenarios: false,
            nightOptimal: false,
            energySaver: false,
            quickOptimizer: false,
            perfectStreak: false,
            masterVentilation: false,
            temperatureExpert: false,
            lightingPro: false  // CORREGIDO: sin espacio
        };

        let achievementCount = 0;

        // ==========================================
        // SISTEMA DE SONIDO
        // ==========================================
        
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (!state.soundEnabled) return;
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            switch(type) {
                case 'success':
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
                case 'achievement':
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'click':
                    oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
            }
        }

        document.getElementById('soundToggle').addEventListener('click', () => {
            state.soundEnabled = !state.soundEnabled;
            document.getElementById('soundToggle').textContent = state.soundEnabled ? 'üîä' : 'üîá';
            playSound('click');
            saveState();
        });

        // ==========================================
        // GENERACI√ìN DE ESTRELLAS
        // ==========================================
        
        function generateStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // ==========================================
        // C√ÅLCULO DE PUNTAJE MEJORADO
        // ==========================================
        
        function calculateScore() {
            const scenario = SCENARIOS[state.scenario];
            let score = 100;
            let penalties = {
                lux: 0,
                ventilation: 0,
                temperature: 0,
                humidity: 0
            };

            // Penalizaci√≥n por iluminaci√≥n (0-35 puntos)
            if (state.lux < scenario.luxMin) {
                penalties.lux = Math.min(35, (scenario.luxMin - state.lux) / 8);
            } else if (state.lux > scenario.luxMax) {
                penalties.lux = Math.min(30, (state.lux - scenario.luxMax) / 15);
            } else {
                const distanceToIdeal = Math.abs(state.lux - scenario.luxIdeal);
                penalties.lux = distanceToIdeal / 25;
            }

            // Penalizaci√≥n por ventilaci√≥n (0-25 puntos)
            const ventilationScore = (state.windowOpen ? 15 : 0) + 
                                     (state.extractorOn ? 10 : 0) + 
                                     (state.fanSpeed / 10);
            penalties.ventilation = Math.max(0, 25 - ventilationScore);

            // Penalizaci√≥n por temperatura (0-25 puntos)
            if (state.temperature < scenario.tempMin) {
                penalties.temperature = (scenario.tempMin - state.temperature) * 2;
            } else if (state.temperature > scenario.tempMax) {
                penalties.temperature = (state.temperature - scenario.tempMax) * 2;
            } else {
                const distanceToIdeal = Math.abs(state.temperature - scenario.tempIdeal);
                penalties.temperature = distanceToIdeal * 1.5;
            }

            // Penalizaci√≥n por humedad (0-15 puntos)
            const humidityDiff = Math.abs(state.humidity - scenario.humidityIdeal);
            penalties.humidity = Math.min(15, humidityDiff / 2);

            // Aplicar penalizaciones
            score -= penalties.lux;
            score -= penalties.ventilation;
            score -= penalties.temperature;
            score -= penalties.humidity;

            // Bonus por eficiencia (LED)
            if (state.lampType === 'led' && state.lux >= scenario.luxMin && state.lux <= scenario.luxMax) {
                score += 5;
            }

            score = Math.max(0, Math.min(100, Math.round(score)));
            
            // Actualizar racha
            if (score >= 85) {
                state.streak++;
                if (state.streak > parseInt(localStorage.getItem('maxStreak') || 0)) {
                    localStorage.setItem('maxStreak', state.streak);
                }
            } else if (score < 50) {
                state.streak = 0;
            }

            state.score = score;
            state.totalPoints += Math.max(0, score - 50);
            
            return score;
        }

        // ==========================================
        // ACTUALIZACI√ìN VISUAL
        // ==========================================
        
        function updateScene() {
            calculateScore();
            updateLighting();
            updateVentilation();
            updateWorker();
            updateMetrics();
            updateStats();
            checkAchievements();
            saveState();
        }

        function updateLighting() {
            const maxDarkness = state.timeOfDay === 'night' ? 0.85 : 
                                state.timeOfDay === 'evening' ? 0.4 : 0.6;
            const opacity = maxDarkness - (state.lux / 1200) * maxDarkness;
            document.getElementById('lightingOverlay').style.background = `rgba(0, 0, 0, ${Math.max(0, opacity)})`;
        }

        function updateVentilation() {
            const container = document.getElementById('particlesContainer');
            const windowFrame = document.getElementById('windowFrame');
            
            windowFrame.classList.toggle('closed', !state.windowOpen);
            
            container.innerHTML = '';
            
            if (state.windowOpen || state.extractorOn) {
                const particleCount = Math.min(20, 
                    (state.windowOpen ? 8 : 0) + 
                    (state.extractorOn ? Math.floor(state.fanSpeed / 10) : 0)
                );
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'air-particle';
                    particle.style.left = Math.random() * 90 + '%';
                    particle.style.top = Math.random() * 70 + '%';
                    particle.style.animationDelay = Math.random() * 3 + 's';
                    particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                    container.appendChild(particle);
                }
            }

            // Agregar part√≠culas de polvo si ventilaci√≥n es baja
            if (!state.windowOpen && !state.extractorOn) {
                for (let i = 0; i < 5; i++) {
                    const dust = document.createElement('div');
                    dust.className = 'dust-particle';
                    dust.style.left = Math.random() * 90 + '%';
                    dust.style.top = Math.random() * 70 + '%';
                    dust.style.animationDelay = Math.random() * 6 + 's';
                    container.appendChild(dust);
                }
            }
        }

        function updateWorker() {
            const worker = document.getElementById('workerAvatar');
            let emoji, status, description;
            
            if (state.score >= 95) {
                emoji = 'ü§©';
                status = '¬°Excelente!';
                description = 'Condiciones perfectas, m√°ximo rendimiento';
            } else if (state.score >= 85) {
                emoji = 'üòÑ';
                status = 'Muy Bien';
                description = 'Ambiente √≥ptimo, alta productividad';
            } else if (state.score >= 70) {
                emoji = 'üòä';
                status = 'Concentrado';
                description = 'Buenas condiciones de trabajo';
            } else if (state.score >= 55) {
                emoji = 'üòê';
                status = 'Regular';
                description = 'Condiciones aceptables';
            } else if (state.score >= 40) {
                emoji = 'üòü';
                status = 'Inc√≥modo';
                description = 'Necesita mejoras en el ambiente';
            } else if (state.score >= 25) {
                emoji = 'üò´';
                status = 'Cansado';
                description = 'Condiciones inadecuadas';
            } else {
                emoji = 'üò¥';
                status = 'Somnoliento';
                description = 'Ambiente muy deficiente';
            }

            worker.textContent = emoji;
            document.getElementById('workerMetricIcon').textContent = emoji;
            document.getElementById('workerMetricStatus').textContent = status;
            document.getElementById('workerConditionDesc').textContent = description;
        }

        function updateMetrics() {
            const scenario = SCENARIOS[state.scenario];
            
            // M√©trica de Lux
            document.getElementById('luxMetricValue').textContent = `${state.lux} lux`;
            const luxPercent = (state.lux / 1200) * 100;
            document.getElementById('luxProgress').style.width = luxPercent + '%';
            
            let luxColor, luxStatus;
            if (state.lux >= scenario.luxMin && state.lux <= scenario.luxMax) {
                luxColor = 'var(--success)';
                luxStatus = '‚úÖ √ìptimo';
                document.getElementById('luxStatusBadge').className = 'status-badge status-optimal';
            } else if ((state.lux >= 200 && state.lux < scenario.luxMin) || 
                       (state.lux > scenario.luxMax && state.lux <= 800)) {
                luxColor = 'var(--warning)';
                luxStatus = '‚ö†Ô∏è Aceptable';
                document.getElementById('luxStatusBadge').className = 'status-badge status-acceptable';
            } else {
                luxColor = 'var(--danger)';
                luxStatus = '‚ùå Insuficiente';
                document.getElementById('luxStatusBadge').className = 'status-badge status-poor';
            }
            document.getElementById('luxProgress').style.background = luxColor;
            document.getElementById('luxStatusBadge').textContent = luxStatus;

            // M√©trica de Ventilaci√≥n
            let airValue, airPercent, airColor, airStatus;
            const ventScore = (state.windowOpen ? 50 : 0) + (state.extractorOn ? 50 : 0);
            
            if (state.windowOpen && state.extractorOn) {
                airValue = '√ìptimo';
                airPercent = 100;
                airColor = 'var(--success)';
                airStatus = '‚úÖ √ìptimo';
                document.getElementById('airStatusBadge').className = 'status-badge status-optimal';
            } else if (state.windowOpen || state.extractorOn) {
                airValue = 'Aceptable';
                airPercent = ventScore;
                airColor = 'var(--warning)';
                airStatus = '‚ö†Ô∏è Aceptable';
                document.getElementById('airStatusBadge').className = 'status-badge status-acceptable';
            } else {
                airValue = 'Sin flujo';
                airPercent = 0;
                airColor = 'var(--danger)';
                airStatus = '‚ùå Malo';
                document.getElementById('airStatusBadge').className = 'status-badge status-poor';
            }
            
            document.getElementById('airMetricValue').textContent = airValue;
            document.getElementById('airProgress').style.width = airPercent + '%';
            document.getElementById('airProgress').style.background = airColor;
            document.getElementById('airStatusBadge').textContent = airStatus;

            // M√©trica del Trabajador
            const workerPercent = state.score;
            document.getElementById('workerProgress').style.width = workerPercent + '%';
            document.getElementById('workerProgress').style.background = 
                state.score >= 80 ? 'var(--success)' : 
                state.score >= 50 ? 'var(--warning)' : 'var(--danger)';

            // M√©trica de Score
            document.getElementById('scoreMetricValue').textContent = `${state.score}/100`;
            document.getElementById('scoreProgress').style.width = state.score + '%';
            
            let scoreColor, scoreStatus;
            if (state.score >= 85) {
                scoreColor = 'var(--success)';
                scoreStatus = '‚úÖ Excelente';
                document.getElementById('scoreStatusBadge').className = 'status-badge status-optimal';
            } else if (state.score >= 60) {
                scoreColor = 'var(--warning)';
                scoreStatus = '‚ö†Ô∏è Mejorable';
                document.getElementById('scoreStatusBadge').className = 'status-badge status-acceptable';
            } else {
                scoreColor = 'var(--danger)';
                scoreStatus = 'üìâ Necesita mejoras';
                document.getElementById('scoreStatusBadge').className = 'status-badge status-poor';
            }
            document.getElementById('scoreProgress').style.background = scoreColor;
            document.getElementById('scoreStatusBadge').textContent = scoreStatus;
        }

        function updateStats() {
            document.getElementById('totalScore').textContent = state.totalPoints;
            document.getElementById('achievementCount').textContent = achievementCount;
            document.getElementById('streakCount').textContent = state.streak;
            document.getElementById('timeDisplay').textContent = 
                state.timeOfDay === 'day' ? 'D√≠a' : 
                state.timeOfDay === 'evening' ? 'Tarde' : 'Noche';
        }

        // ==========================================
        // SISTEMA DE LOGROS
        // ==========================================
        
        function checkAchievements() {
            if (state.score >= 85 && !achievements.firstOptimal) {
                unlockAchievement('firstOptimal', 'üéØ Primera Optimizaci√≥n', 'Has alcanzado condiciones √≥ptimas por primera vez');
            }

            if (state.score >= 98 && !achievements.perfectScore) {
                unlockAchievement('perfectScore', '‚≠ê Perfecci√≥n Total', 'Score casi perfecto (98+)');
            }

            if (state.score >= 85 && state.timeOfDay === 'night' && !achievements.nightOptimal) {
                unlockAchievement('nightOptimal', 'üåô Maestro Nocturno', 'Condiciones √≥ptimas de noche');
            }

            if (state.lampType === 'led' && state.score >= 80 && !achievements.energySaver) {
                unlockAchievement('energySaver', 'üí° Ahorro Energ√©tico', 'Usa LED con excelentes resultados');
            }

            if (state.streak >= 5 && !achievements.perfectStreak) {
                unlockAchievement('perfectStreak', 'üî• Racha Perfecta', '5 puntuaciones seguidas >85');
            }

            if (state.windowOpen && state.extractorOn && state.fanSpeed >= 70 && !achievements.masterVentilation) {
                unlockAchievement('masterVentilation', 'üå¨Ô∏è Maestro de Ventilaci√≥n', 'Ventilaci√≥n m√°xima alcanzada');
            }

            const scenario = SCENARIOS[state.scenario];
            if (Math.abs(state.temperature - scenario.tempIdeal) < 0.5 && !achievements.temperatureExpert) {
                unlockAchievement('temperatureExpert', 'üå°Ô∏è Experto en Temperatura', 'Temperatura perfecta');
            }

            if (state.lux === scenario.luxIdeal && !achievements.lightingPro) {
                unlockAchievement('lightingPro', 'üí° Profesional de Iluminaci√≥n', 'Lux exacto al ideal');
            }
        }

        function unlockAchievement(id, title, description) {
            achievements[id] = true;
            achievementCount++;
            playSound('achievement');
            showAchievement(title, description);
            saveState();
        }

        function showAchievement(title, description) {
            const panel = document.getElementById('achievementsPanel');
            const item = document.createElement('div');
            item.className = 'achievement-item';
            item.innerHTML = `
                <div class="achievement-icon">${title.split(' ')[0]}</div>
                <div class="achievement-text">
                    <div class="achievement-title">${title}</div>
                    <div class="achievement-desc">${description}</div>
                </div>
            `;
            panel.appendChild(item);
            
            setTimeout(() => {
                item.style.animation = 'slideInRight 0.5s reverse';
                setTimeout(() => item.remove(), 500);
            }, 5000);
        }

        // ==========================================
        // EVENT LISTENERS
        // ==========================================
        
        document.getElementById('luxSlider').addEventListener('input', (e) => {
            state.lux = parseInt(e.target.value);
            document.getElementById('luxValueDisplay').textContent = `${state.lux} lux`;
            updateScene();
        });

        document.getElementById('lampType').addEventListener('change', (e) => {
            state.lampType = e.target.value;
            playSound('click');
            updateScene();
        });

        document.getElementById('windowToggle').addEventListener('change', (e) => {
            state.windowOpen = e.target.checked;
            playSound('click');
            updateScene();
        });

        document.getElementById('extractorToggle').addEventListener('change', (e) => {
            state.extractorOn = e.target.checked;
            if (e.target.checked) {
                state.fanSpeed = 50;
                document.getElementById('fanSpeedSlider').value = 50;
                document.getElementById('fanSpeedDisplay').textContent = '50%';
            }
            playSound('click');
            updateScene();
        });

        document.getElementById('fanSpeedSlider').addEventListener('input', (e) => {
            state.fanSpeed = parseInt(e.target.value);
            document.getElementById('fanSpeedDisplay').textContent = `${state.fanSpeed}%`;
            if (state.fanSpeed > 0) {
                state.extractorOn = true;
                document.getElementById('extractorToggle').checked = true;
            }
            updateScene();
        });

        document.getElementById('tempSlider').addEventListener('input', (e) => {
            state.temperature = parseFloat(e.target.value);
            document.getElementById('tempValueDisplay').textContent = `${state.temperature}¬∞C`;
            updateScene();
        });

        document.getElementById('humiditySlider').addEventListener('input', (e) => {
            state.humidity = parseInt(e.target.value);
            document.getElementById('humidityDisplay').textContent = `${state.humidity}%`;
            updateScene();
        });

        // Selector de escenarios
        document.querySelectorAll('.scenario-card').forEach(card => {
            card.addEventListener('click', (e) => {
                playSound('click');
                document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                
                state.scenario = card.dataset.scenario;
                const scenario = SCENARIOS[state.scenario];
                
                document.getElementById('scenarioIcon').textContent = scenario.icon;
                document.getElementById('scenarioName').textContent = scenario.name;
                
                updateScene();
            });
        });

        // Control de tiempo del d√≠a
        document.querySelectorAll('.time-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                playSound('click');
                document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                state.timeOfDay = btn.dataset.time;
                const scene = document.getElementById('scene3d');
                scene.className = 'scene-3d ' + state.timeOfDay;
                
                updateScene();
            });
        });

        // ==========================================
        // FUNCIONES DE CONTROL
        // ==========================================
        
        function autoOptimize() {
            const scenario = SCENARIOS[state.scenario];
            
            state.lux = scenario.luxIdeal;
            state.lampType = 'led';
            state.windowOpen = true;
            state.extractorOn = true;
            state.fanSpeed = 70;
            state.temperature = scenario.tempIdeal;
            state.humidity = scenario.humidityIdeal;

            // Actualizar UI
            document.getElementById('luxSlider').value = state.lux;
            document.getElementById('luxValueDisplay').textContent = `${state.lux} lux`;
            document.getElementById('lampType').value = 'led';
            document.getElementById('windowToggle').checked = true;
            document.getElementById('extractorToggle').checked = true;
            document.getElementById('fanSpeedSlider').value = state.fanSpeed;
            document.getElementById('fanSpeedDisplay').textContent = `${state.fanSpeed}%`;
            document.getElementById('tempSlider').value = state.temperature;
            document.getElementById('tempValueDisplay').textContent = `${state.temperature}¬∞C`;
            document.getElementById('humiditySlider').value = state.humidity;
            document.getElementById('humidityDisplay').textContent = `${state.humidity}%`;

            playSound('success');
            updateScene();
            showConfetti();
            showToast('‚ú® ¬°Ambiente optimizado! Condiciones perfectas alcanzadas');
        }

        function resetAll() {
            if (confirm('¬øDeseas reiniciar todos los controles y logros?')) {
                state = {
                    scenario: 'office',
                    lux: 200,
                    lampType: 'led',
                    windowOpen: false,
                    extractorOn: false,
                    fanSpeed: 0,
                    temperature: 22,
                    humidity: 50,
                    timeOfDay: 'day',
                    score: 0,
                    totalPoints: 0,
                    streak: 0,
                    soundEnabled: state.soundEnabled
                };

                achievements = Object.keys(achievements).reduce((acc, key) => {
                    acc[key] = false;
                    return acc;
                }, {});
                achievementCount = 0;

                // Reset UI
                document.getElementById('luxSlider').value = 200;
                document.getElementById('luxValueDisplay').textContent = '200 lux';
                document.getElementById('lampType').value = 'led';
                document.getElementById('windowToggle').checked = false;
                document.getElementById('extractorToggle').checked = false;
                document.getElementById('fanSpeedSlider').value = 0;
                document.getElementById('fanSpeedDisplay').textContent = '0%';
                document.getElementById('tempSlider').value = 22;
                document.getElementById('tempValueDisplay').textContent = '22¬∞C';
                document.getElementById('humiditySlider').value = 50;
                document.getElementById('humidityDisplay').textContent = '50%';

                document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
                document.querySelector('[data-scenario="office"]').classList.add('active');
                document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                document.querySelector('[data-time="day"]').classList.add('active');

                localStorage.clear();
                playSound('click');
                updateScene();
                showToast('üîÑ Sistema reiniciado completamente');
            }
        }

        function showSummary() {
            document.getElementById('summaryModal').classList.add('active');
            playSound('click');
        }

        function closeSummary() {
            document.getElementById('summaryModal').classList.remove('active');
        }

        document.getElementById('summaryModal').addEventListener('click', (e) => {
            if (e.target.id === 'summaryModal') closeSummary();
        });

        // ==========================================
        // EFECTOS VISUALES
        // ==========================================
        
        function showConfetti() {
            const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ec4899', '#8b5cf6', '#06b6d4'];
            
            for (let i = 0; i < 80; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.width = (5 + Math.random() * 10) + 'px';
                    confetti.style.height = confetti.style.width;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<span style="font-size: 1.5rem; margin-right: 5px;">üéâ</span>${message}`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.4s reverse';
                setTimeout(() => toast.remove(), 400);
            }, 3500);
        }

        // ==========================================
        // PERSISTENCIA
        // ==========================================
        
        function saveState() {
            try {
                localStorage.setItem('zonasegura360_state', JSON.stringify({
                    state,
                    achievements,
                    achievementCount
                }));
            } catch (e) {
                console.log('Error al guardar');
            }
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('zonasegura360_state');
                if (saved) {
                    const data = JSON.parse(saved);
                    state = { ...state, ...data.state };
                    achievements = { ...achievements, ...data.achievements };
                    achievementCount = data.achievementCount || 0;

                    // Actualizar UI
                    document.getElementById('luxSlider').value = state.lux;
                    document.getElementById('luxValueDisplay').textContent = `${state.lux} lux`;
                    document.getElementById('lampType').value = state.lampType;
                    document.getElementById('windowToggle').checked = state.windowOpen;
                    document.getElementById('extractorToggle').checked = state.extractorOn;
                    document.getElementById('fanSpeedSlider').value = state.fanSpeed;
                    document.getElementById('fanSpeedDisplay').textContent = `${state.fanSpeed}%`;
                    document.getElementById('tempSlider').value = state.temperature;
                    document.getElementById('tempValueDisplay').textContent = `${state.temperature}¬∞C`;
                    document.getElementById('humiditySlider').value = state.humidity;
                    document.getElementById('humidityDisplay').textContent = `${state.humidity}%`;
                    document.getElementById('soundToggle').textContent = state.soundEnabled ? 'üîä' : 'üîá';

                    document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
                    document.querySelector(`[data-scenario="${state.scenario}"]`)?.classList.add('active');
                    
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector(`[data-time="${state.timeOfDay}"]`)?.classList.add('active');

                    const scene = document.getElementById('scene3d');
                    scene.className = 'scene-3d ' + state.timeOfDay;

                    const scenario = SCENARIOS[state.scenario];
                    document.getElementById('scenarioIcon').textContent = scenario.icon;
                    document.getElementById('scenarioName').textContent = scenario.name;
                }
            } catch (e) {
                console.log('Error al cargar');
            }
        }

        // ==========================================
        // ATAJOS DE TECLADO
        // ==========================================
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('summaryModal').classList.contains('active')) {
                closeSummary();
            }
            
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                autoOptimize();
            }

            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetAll();
            }

            if (e.key === 'h') {
                showSummary();
            }
        });

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        
        function init() {
            generateStars();
            loadState();
            updateScene();
            
            setTimeout(() => {
                showToast('üéÆ ¬°Bienvenido a Zona Segura 360¬∞ Mejorado! Explora los controles y desbloquea logros');
            }, 800);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>